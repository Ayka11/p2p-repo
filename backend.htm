<?php
//connect to the database
$db_hostname = 'localhost';
$db_database = 'p2ptrading';
$db_username = 'username';
$db_password = 'password';

$mysqli = new mysqli($db_hostname, $db_username, $db_password, $db_database);

if ($mysqli->connect_error) {
    die('Connect Error (' . $mysqli->connect_errno . ') '
            . $mysqli->connect_error);
}

//start session
session_start();

//user login
function login($email, $password){
    global $mysqli;
    $query = "SELECT * FROM users WHERE email='$email' AND password='$password'";
    $result = $mysqli->query($query);

    if ($result->num_rows == 1){
        $row = $result->fetch_assoc();
        $_SESSION['user_id'] = $row['id'];
        $_SESSION['user_email'] = $row['email'];
        return true;
    } else {
        return false;
    }
}

//user registration
function register($email, $password, $name){
    global $mysqli;
    $query = "INSERT INTO users (email, password, name) VALUES ('$email', '$password', '$name')";
    $result = $mysqli->query($query);

    if ($result){
        return true;
    } else {
        return false;
    }
}

//get user details
function get_user($user_id){
    global $mysqli;
    $query = "SELECT * FROM users WHERE id='$user_id'";
    $result = $mysqli->query($query);

    if ($result->num_rows == 1){
        $row = $result->fetch_assoc();
        return $row;
    } else {
        return false;
    }
}

//get all listings
function get_listings(){
    global $mysqli;
    $query = "SELECT * FROM listings";
    $result = $mysqli->query($query);

    $listings = array();
    while ($row = $result->fetch_assoc()){
        $listings[] = $row;
    }
    return $listings;
}

//add new listing
function add_listing($user_id, $title, $description, $price){
    global $mysqli;
    $query = "INSERT INTO listings (user_id, title, description, price) VALUES ('$user_id', '$title', '$description', '$price')";
    $result = $mysqli->query($query);

    if ($result){
        return true;
    } else {
        return false;
    }
}

//get a listing by id
function get_listing($listing_id){
    global $mysqli;
    $query = "SELECT * FROM listings WHERE id='$listing_id'";
    $result = $mysqli->query($query);

    if ($result->num_rows == 1){
        $row = $result->fetch_assoc();
        return $row;
    } else {
        return false;
    }
}

//make a purchase
function purchase($user_id, $listing_id){
    global $mysqli;
    $query = "INSERT INTO purchases (user_id, listing_id) VALUES ('$user_id', '$listing_id')";
    $result = $mysqli->query($query);

    if ($result){
        return true;
    } else {
        return false;
    }
}

//get purchases by user id
function get_purchases($user_id){
    global

 
